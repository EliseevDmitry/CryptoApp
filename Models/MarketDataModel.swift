//
//  MarketDataModel.swift
//  CryptoApp
//
//  Created by Dmitriy Eliseev on 23.12.2024.
//

import Foundation

/*
 https://api.coingecko.com/api/v3/global
 */

/*
 {
   "data": {
     "active_cryptocurrencies": 16255,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1197,
     "total_market_cap": {
       "btc": 36023768.495083734,
       "eth": 1039945190.5575837,
       "ltc": 33655098693.48616,
       "bch": 7751431910.971619,
       "bnb": 5151738072.384762,
       "eos": 4321982073128.192,
       "xrp": 1572089004758.9143,
       "xlm": 9666323326283.82,
       "link": 151421252784.00067,
       "dot": 497772700110.71326,
       "yfi": 397824854.26696527,
       "usd": 3426888196236.8823,
       "aed": 12586840403691.2,
       "ars": 3.503035365401364e+15,
       "aud": 5480348141185.947,
       "bdt": 407768239945435.7,
       "bhd": 1292457736987.1328,
       "bmd": 3426888196236.8823,
       "brl": 20855356184658.418,
       "cad": 4929095479051.085,
       "chf": 3066033442284.943,
       "clp": 3392958610474823.5,
       "cny": 25012856944333.004,
       "czk": 82766546404332.78,
       "dkk": 24550346978927.895,
       "eur": 3291731725777.3,
       "gbp": 2727590537136.3916,
       "gel": 9620981757158.654,
       "hkd": 26626952126754.34,
       "huf": 1.364998106325075e+15,
       "idr": 5.552745454390759e+16,
       "ils": 12492463902766.834,
       "inr": 291637050859522.4,
       "jpy": 536680676802412.6,
       "krw": 4.981227026017002e+15,
       "kwd": 1055481564440.9595,
       "lkr": 1001852179474677.2,
       "mmk": 7.189611435704979e+15,
       "mxn": 68854062278362.09,
       "myr": 15388441445201.72,
       "ngn": 5.299511251070525e+15,
       "nok": 38735093945201.41,
       "nzd": 6063518839980.559,
       "php": 200801964734913.75,
       "pkr": 949809354644159.9,
       "pln": 14021280972424.818,
       "rub": 349360604264724.5,
       "sar": 12876851097962.334,
       "sek": 37839178575841.83,
       "sgd": 4646226419780.909,
       "thb": 117178158260074.9,
       "try": 120693974205004.12,
       "twd": 112052397094329.98,
       "uah": 143110613798091.66,
       "vef": 343134315089.19904,
       "vnd": 8.719817857678322e+16,
       "zar": 63030151461062.44,
       "xdr": 2602978601656.63,
       "xag": 115187650251.29071,
       "xau": 1302423127.8617895,
       "bits": 36023768495083.734,
       "sats": 3602376849508373.5
     },
     "total_volume": {
       "btc": 2007648.2285630493,
       "eth": 57957404.42620626,
       "ltc": 1875639393.0111234,
       "bch": 431996684.2728593,
       "bnb": 287112599.46209145,
       "eos": 240869293121.88,
       "xrp": 87614423404.32588,
       "xlm": 538715901013.5174,
       "link": 8438889728.043984,
       "dot": 27741475180.218967,
       "yfi": 22171260.734601542,
       "usd": 190984627763.12622,
       "aed": 701479853311.9908,
       "ars": 195228401684336.75,
       "aud": 305426436411.3467,
       "bdt": 22725417655913.777,
       "bhd": 72030234330.11858,
       "bmd": 190984627763.12622,
       "brl": 1162294247640.8335,
       "cad": 274704458204.7424,
       "chf": 170873755475.0413,
       "clp": 189093690873489.78,
       "cny": 1393996798043.0583,
       "czk": 4612679828197.8,
       "dkk": 1368220557757.008,
       "eur": 183452194044.14853,
       "gbp": 152011922652.52713,
       "gel": 536188960475.72125,
       "hkd": 1483952276581.1404,
       "huf": 76072996930608.44,
       "idr": 3094612263203536.5,
       "ils": 696220136663.3942,
       "inr": 16253285899874.064,
       "jpy": 29909863823198.477,
       "krw": 277609812427542.78,
       "kwd": 58823265351.04286,
       "lkr": 55834434803201.195,
       "mmk": 400685749047038.75,
       "mxn": 3837320245420.4316,
       "myr": 857616470970.3182,
       "ngn": 295348177604286.44,
       "nok": 2158753678225.5278,
       "nzd": 337927245440.9367,
       "php": 11190936585300.54,
       "pkr": 52934025172413.555,
       "pln": 781422962739.5913,
       "rub": 19470289411212.258,
       "sar": 717642500390.3286,
       "sek": 2108823230097.0195,
       "sgd": 258939823090.66296,
       "thb": 6530480615575.397,
       "try": 6726421294428.976,
       "twd": 6244815740567.957,
       "uah": 7975727756509.434,
       "vef": 19123290777.921825,
       "vnd": 4.859660054097189e+15,
       "zar": 3512746645152.6943,
       "xdr": 145067148633.1766,
       "xag": 6419547194.539186,
       "xau": 72585617.62765375,
       "bits": 2007648228563.0493,
       "sats": 200764822856304.94
     },
     "market_cap_percentage": {
       "btc": 54.963691549100865,
       "eth": 11.589336047365514,
       "usdt": 4.074823791130672,
       "xrp": 3.643653052970916,
       "bnb": 2.831119361690511,
       "sol": 2.5584383120092236,
       "doge": 1.3416246229185973,
       "usdc": 1.252872529186839,
       "steth": 0.9340375213329675,
       "ada": 0.9299373186661081
     },
     "market_cap_change_percentage_24h_usd": -2.0201763855994876,
     "updated_at": 1734943463
   }
 }
 */


struct GlobalData: Codable {
    let data: MarketDataModel?
}

// MARK: - DataClass
struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double


    enum CodingKeys: String, CodingKey {

        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap["usd"] {
            return "\(item)"
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume["usd"] {
            return "\(item)"
        }
        return ""
    }
    
    //Nick в видео предлагает другой вариант работы со словарем
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: {$0.key == "btc"}) {
            return "\(item.value.asPersentString())"
        }
        return ""
    }
    
}
